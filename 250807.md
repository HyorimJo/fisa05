# 8/7 ELK 2일차

## Keywords
match_all and or
must/ must_not/ should/ filter


***

## Keeps
가중치를 주고 싶다면 should를 쓰기

## Problem
헉 너무 복잡하다

## Try
노멀라이저!


## 알아둘 내용

### 1. google 이라는 단어가 들어간 모든 문서를 검색해보세요
- match는 소문자 대문자 안가리고 검색을 해줍니다 
- 띄어쓰기가 OR로 취급됩니다
```
GET my_bulk/_search
{
    "query": {
        "match": {"message":"google"}
    }
}
```

### 2. Chrome Google이 순서대로 들어있는 문서를 검색
```
GET my_bulk/_search
{
  "query": {
    "match_phrase": {
      "message":
      { 
        "query" : "Chrome google"
      }
    }
  }
}
```

### 3. pink가 들어가되 blue가 같이 들어있는 경우 가중치 부여 (blue가 없는 경우는 후순위로 검색)
```
GET my_bulk/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "message": "pink"
          }
        }
      ],
      "should": [
        {
          "match": {
            "message": "blue"
          }
        }
      ]
    }
  }
}
```

### 4. pink가 들어가되 blue가 같이 들어있는 경우 SCORE는 바뀌지 않되 해당 조건을 검색
```
GET my_bulk/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "message": "pink"
          }
        }
      ],
      "filter": [
        {
          "match": {
            "message": "blue"
          }
        }
      ]
    }
  }
}
```

### 5. "하늘사"라는 단어가 있거나 없거나 상관 없이 google, chrome이 들어간 경우 검색
```
GET my_bulk/_search
{
  "query": {
    "match": {
      "message":
      { 
        "query" : "Chrome google"
      }
    }
  }
}
```

### 6. 하늘사는 안들어가고 chrome은 들어가는 다큐먼트를 검색
```
GET my_bulk/_search
{
  "query": {
    "bool": {
      "must_not": [
        {
          "match": {
            "message": "하늘사"
          }
        }
      ],
      "must": [
        {
          "match": {
            "message": "chrome"
          }
        }
      ]
    }
  }
}
```

### 6-1. 하늘사가 없어서 점수를 부여하고 싶으면 bool
```
GET my_bulk/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "message": "chrome" } }
      ],
      "must_not": [
        {
          "bool": {
            "should": {
              "match": { "message": "하늘사" }
            }
          }
        }
      ]
    }
  }
}
```

### 6-2. 하늘사가 없다고 거기에 점수는 부여하지 않고 싶으면 filter
```
GET my_bulk/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "message": "chrome" } }
      ],
      "must_not": [
        {
          "bool": {
            "filter": {
              "match": { "message": "하늘사" }
            }
          }
        }
      ]
    }
  }
}
```